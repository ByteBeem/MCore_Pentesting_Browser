#include "terminal.h"

Terminal::Terminal(QWidget *parent)
    : QWidget(parent),
      terminalWidget(new QTermWidget(this)),
      process(new QProcess(this)) {
    QVBoxLayout *layout = new QVBoxLayout(this);
    layout->addWidget(terminalWidget);
    setLayout(layout);

    
    connect(process, &QProcess::readyReadStandardOutput, [this]() {
        terminalWidget->appendPlainText(process->readAllStandardOutput());
    });
    connect(process, &QProcess::readyReadStandardError, [this]() {
        terminalWidget->appendPlainText(process->readAllStandardError());
    });
    connect(process, QOverload<int, QProcess::ExitStatus>::of(&QProcess::finished), [this](int exitCode, QProcess::ExitStatus exitStatus) {
        terminalWidget->appendPlainText(QString("Process finished with exit code %1 and status %2").arg(exitCode).arg(exitStatus));
    });
}

Terminal::~Terminal() {
    delete process;
    delete terminalWidget;
}

void Terminal::executePythonScript(const QString &scriptPath) {
    if (!scriptPath.endsWith(".py")) {
        terminalWidget->appendPlainText("Error: Not a Python script.");
        return;
    }

    QStringList arguments;
    arguments << scriptPath;

    process->start("python3", arguments);
}
